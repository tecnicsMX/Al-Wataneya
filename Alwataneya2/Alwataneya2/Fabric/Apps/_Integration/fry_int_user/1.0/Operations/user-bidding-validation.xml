<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<service serviceGroup="" cachable="false" cacheduration="" customOperation="false" description="" endpoint="default" groupType="" id="user-bidding-validation" passwordencrypted="false" security="public" type="dataAdapterConnector" smscode="" smsenabled="false">
    <service-config>
        <config-param api-version="" appid="" name="preprocessorname" value=""/>
        <config-param api-version="" appid="" name="postprocessorname" value=""/>
        <config-param api-version="" appid="" name="preprocessorJS" value=""/>
        <config-param api-version="" appid="" name="postprocessorJS" value="function UserBiddingVerification() {&#13;&#10;    // Get the response object&#13;&#10;    var resultObj = voltMX.getResultObject();&#13;&#10;    &#13;&#10;    var resultJson = resultObj.toJson();&#13;&#10;    var result = resultJson.records[0];&#13;&#10;   &#13;&#10;&#13;&#10;    if(resultJson.records.length &gt; 0){&#13;&#10;        // resultObj.params['allowed_bidding']=result.allowed_bidding;&#13;&#10;        // resultObj.params['deposite_limit']=result.deposite_limit;&#13;&#10;        // resultObj.params['bidding_deposite_limit']=result.bidding_deposite_limit;&#13;&#10;        // resultObj.params['has_security_dep']=result.has_security_dep;&#13;&#10;        // resultObj.params['user_type']=result.user_type;&#13;&#10;        // resultObj.params['user_id']=result.user_id;&#13;&#10;        // resultObj.params['deposite_value']=result.deposite_value;&#13;&#10;        // resultObj.params['credit_limit']=result.credit_limit;&#13;&#10;        // resultObj.params['bidding_deposite_value']=result.bidding_deposite_value;&#13;&#10;        // resultObj.params['suspended']=result.suspended;&#13;&#10;        // resultObj.params['user_vehcile_total_bidded_amount']=parseInt(result.user_vehcile_total_bidded_amount);&#13;&#10;resultObj.params['total_bidded_amount']=result.user_vehcile_total_bidded_amount;&#13;&#10;&#13;&#10;        var credit_limit_int = parseInt(result.credit_limit);&#13;&#10;        var bidding_deposite_value_int = parseInt(result.bidding_deposite_value)&#13;&#10;        var user_vehcile_total_bidded_amount_int = parseInt(result.user_vehcile_total_bidded_amount)&#13;&#10;        if(credit_limit_int &gt;= user_vehcile_total_bidded_amount_int &amp;&amp;&#13;&#10;            parseInt(result.allowed_bidding) == 1 ){&#13;&#10;            resultObj.params['condition_message']=&quot;Success&quot;;&#13;&#10;            resultObj.params['message']=&quot;Success&quot;;&#13;&#10;        }&#13;&#10;        else{&#13;&#10;            resultObj.params['condition_message']=&quot;Fail&quot;;&#13;&#10;            resultObj.params['message']=&quot;Fail&quot;;&#13;&#10;        }&#13;&#10;    }&#13;&#10;    else{&#13;&#10;        resultObj.params['condition_message']=&quot;Fail&quot;;&#13;&#10;        resultObj.params['message']=&quot;Fail&quot;;&#13;&#10;    }&#13;&#10;&#13;&#10;    resultObj.update();&#13;&#10;}&#13;&#10;&#13;&#10;// Execute the function&#13;&#10;UserBiddingVerification();&#13;&#10;"/>
        <config-param api-version="" appid="" name="preprocessorRules" value=""/>
        <config-param api-version="" appid="" name="postprocessorRules" value=""/>
        <config-param api-version="" appid="" name="kony_http_supported_methods" value="POST"/>
        <config-param api-version="" appid="" name="endpointUrl" value=""/>
        <config-param api-version="" appid="" name="opcode" value="service"/>
        <config-param api-version="" appid="" name="sockettimeout" value=""/>
        <config-param api-version="" appid="" name="entitymetadata" value="{&quot;dml&quot;:false,&quot;query&quot;:&quot;WITH user_info AS (\n    SELECT \n        u.allowed_bidding,\n        u.suspended,\n        u.user_type,\n        u.user_id,\n        usd.amount AS deposite_value,\n        udl.max_bid AS deposite_limit,\n        CASE \n            WHEN usd.amount &gt; 0 THEN 1\n            ELSE 0\n        END AS has_security_dep\n    FROM users u\n    LEFT JOIN users_security_deposit usd ON usd.user_id = u.user_id\n    LEFT JOIN master_bid_deposit_limits udl ON udl.deposit_limit = usd.amount\n    WHERE \n        u.allowed_bidding = 1 \n        AND u.suspended = 0 \n        AND u.job_title LIKE '%buyer%'\n        AND u.user_id = @user_id_1\n),\nbidding_info AS (\n    SELECT \n        usd.user_id,\n        (udl.max_bid - COALESCE(MAX(ad.bid_amount), 0)) AS credit_limit,\n        usd.amount AS deposite_value,\n        udl.max_bid AS deposite_limit,\n        MAX(ad.bid_amount) AS vechile_max_bid\n    FROM users_security_deposit usd\n    LEFT JOIN master_bid_deposit_limits udl ON udl.deposit_limit = usd.amount\n    LEFT JOIN auction_bidding ad ON ad.bid_by = usd.user_id AND ad.is_approved = 0\n    WHERE usd.user_id = @user_id_2\n    GROUP BY usd.user_id, usd.amount, udl.max_bid\n)\nSELECT \n    ui.allowed_bidding,\n    ui.suspended,\n    ui.user_type,\n    ui.user_id,\n    ui.deposite_value,\n    ui.deposite_limit,\n    ui.has_security_dep,\n    bi.credit_limit,\n    bi.deposite_value AS bidding_deposite_value,\n    bi.deposite_limit AS bidding_deposite_limit,\n    bi.vechile_max_bid,\n    cast(@user_bidded_vehicle_amount as DECIMAL(18,2)) + cast(@user_bidded_vehicle_hike as DECIMAL(18,2))   as user_vehcile_total_bidded_amount\nFROM user_info ui\nLEFT JOIN bidding_info bi ON ui.user_id = bi.user_id;\n&quot;,&quot;overloadPosition&quot;:0,&quot;serviceInput&quot;:[{&quot;type&quot;:&quot;STRING&quot;,&quot;name&quot;:&quot;user_bidded_vehicle_hike&quot;,&quot;inoutType&quot;:0,&quot;sqlDataType&quot;:0,&quot;ordinalPosition&quot;:0,&quot;paramClass&quot;:&quot;com.kony.rdbms.metadata.model.ParamTypeData&quot;},{&quot;type&quot;:&quot;STRING&quot;,&quot;name&quot;:&quot;user_id_2&quot;,&quot;inoutType&quot;:0,&quot;sqlDataType&quot;:0,&quot;ordinalPosition&quot;:0,&quot;paramClass&quot;:&quot;com.kony.rdbms.metadata.model.ParamTypeData&quot;},{&quot;type&quot;:&quot;STRING&quot;,&quot;name&quot;:&quot;user_id_1&quot;,&quot;inoutType&quot;:0,&quot;sqlDataType&quot;:0,&quot;ordinalPosition&quot;:0,&quot;paramClass&quot;:&quot;com.kony.rdbms.metadata.model.ParamTypeData&quot;},{&quot;type&quot;:&quot;STRING&quot;,&quot;name&quot;:&quot;user_bidded_vehicle_amount&quot;,&quot;inoutType&quot;:0,&quot;sqlDataType&quot;:0,&quot;ordinalPosition&quot;:0,&quot;paramClass&quot;:&quot;com.kony.rdbms.metadata.model.ParamTypeData&quot;}],&quot;serviceOutput&quot;:[],&quot;name&quot;:&quot;CustomQuery&quot;,&quot;schemaName&quot;:&quot;dbo&quot;,&quot;serviceType&quot;:&quot;com.kony.rdbms.metadata.model.CustomQueryMetadata&quot;}"/>
        <config-param api-version="" appid="" name="metadataformatterobject" value="{&quot;overloadPosition&quot;:0,&quot;serviceType&quot;:&quot;com.kony.rdbms.metadata.model.CustomQueryMetadata&quot;,&quot;dml&quot;:false,&quot;serviceOutput&quot;:[],&quot;displayName&quot;:&quot;CustomQuery&quot;,&quot;qualifiedName&quot;:&quot;dbo_CustomQuery&quot;,&quot;pkgName&quot;:&quot;&quot;,&quot;serviceInput&quot;:[],&quot;name&quot;:&quot;CustomQuery&quot;,&quot;schemaName&quot;:&quot;dbo&quot;,&quot;qualifiedNameSuffix&quot;:&quot;&quot;}"/>
        <config-param api-version="" appid="" name="isCustomQuery" value="true"/>
        <config-param api-version="" appid="" name="customQuery" value="WITH user_info AS (&#10;    SELECT &#10;        u.allowed_bidding,&#10;        u.suspended,&#10;        u.user_type,&#10;        u.user_id,&#10;        usd.amount AS deposite_value,&#10;        udl.max_bid AS deposite_limit,&#10;        CASE &#10;            WHEN usd.amount &gt; 0 THEN 1&#10;            ELSE 0&#10;        END AS has_security_dep&#10;    FROM users u&#10;    LEFT JOIN users_security_deposit usd ON usd.user_id = u.user_id&#10;    LEFT JOIN master_bid_deposit_limits udl ON udl.deposit_limit = usd.amount&#10;    WHERE &#10;        u.allowed_bidding = 1 &#10;        AND u.suspended = 0 &#10;        AND u.job_title LIKE '%buyer%'&#10;        AND u.user_id = @user_id_1&#10;),&#10;bidding_info AS (&#10;    SELECT &#10;        usd.user_id,&#10;        (udl.max_bid - COALESCE(MAX(ad.bid_amount), 0)) AS credit_limit,&#10;        usd.amount AS deposite_value,&#10;        udl.max_bid AS deposite_limit,&#10;        MAX(ad.bid_amount) AS vechile_max_bid&#10;    FROM users_security_deposit usd&#10;    LEFT JOIN master_bid_deposit_limits udl ON udl.deposit_limit = usd.amount&#10;    LEFT JOIN auction_bidding ad ON ad.bid_by = usd.user_id AND ad.is_approved = 0&#10;    WHERE usd.user_id = @user_id_2&#10;    GROUP BY usd.user_id, usd.amount, udl.max_bid&#10;)&#10;SELECT &#10;    ui.allowed_bidding,&#10;    ui.suspended,&#10;    ui.user_type,&#10;    ui.user_id,&#10;    ui.deposite_value,&#10;    ui.deposite_limit,&#10;    ui.has_security_dep,&#10;    bi.credit_limit,&#10;    bi.deposite_value AS bidding_deposite_value,&#10;    bi.deposite_limit AS bidding_deposite_limit,&#10;    bi.vechile_max_bid,&#10;    cast(@user_bidded_vehicle_amount as DECIMAL(18,2)) + cast(@user_bidded_vehicle_hike as DECIMAL(18,2))   as user_vehcile_total_bidded_amount&#10;FROM user_info ui&#10;LEFT JOIN bidding_info bi ON ui.user_id = bi.user_id;&#10;"/>
        <config-param api-version="" appid="" name="password" value="et_dev@12"/>
        <config-param api-version="" appid="" name="http_auth_mode" value="none"/>
        <config-param api-version="" appid="" name="advancedSettings" value=""/>
        <config-param api-version="" appid="" name="jdbcUrl" value="jdbc:sqlserver://et-az-dev-sqlmi.3ba814f9a3e7.database.windows.net;databaseName=et_dev_awa_tx;encrypt=true"/>
        <config-param api-version="" appid="" name="jdbcClass" value="com.microsoft.sqlserver.jdbc.SQLServerDriver"/>
        <config-param api-version="" appid="" name="userId" value="et_dev_awa_tx_user"/>
        <config-param api-version="" appid="" name="maxPoolSize" value=""/>
        <config-param api-version="" appid="" name="connectionTimeout" value=""/>
        <config-param api-version="" appid="" name="authservicetype" value="IdentityProvider"/>
        <config-param api-version="" appid="" name="adaptertype" value="CUSTOM"/>
        <config-param api-version="" appid="" name="basepackage" value="com.kony.rdbms"/>
        <config-param api-version="" appid="" name="identityProviderType" value=""/>
        <config-param api-version="" appid="" name="identityProvider" value=""/>
        <config-param api-version="" appid="" name="mapped_to" value="dbo.CustomQuery"/>
    </service-config>
    <service-input passthrough="false" isExtended="false">
        <header datatype="" name="" passthrough="false" isExtended="false"/>
        <param datatype="string" defaultvalue="" description="" encode="true" format="None" formatvalue="" name="user_id_1" order="" paramOrder="1" parentOrder="-1" passnull="false" sms-name="" src="request" sourcevalue="" srcformatvalue="" target="request" targetdatatype="java.lang.String" testvalue="4054" value="" isExtended="false">
            <accessType></accessType>
        </param>
        <param datatype="string" defaultvalue="" description="" encode="true" format="None" formatvalue="" name="user_id_2" order="" paramOrder="2" parentOrder="-1" passnull="false" sms-name="" src="request" sourcevalue="" srcformatvalue="" target="request" targetdatatype="java.lang.String" testvalue="4054" value="" isExtended="false">
            <accessType></accessType>
        </param>
        <param datatype="string" defaultvalue="" description="" encode="true" format="None" formatvalue="" name="user_bidded_vehicle_amount" order="" paramOrder="3" parentOrder="-1" passnull="false" sms-name="" src="request" sourcevalue="" srcformatvalue="" target="request" targetdatatype="java.lang.String" testvalue="15000" value="" isExtended="false">
            <accessType></accessType>
        </param>
        <param datatype="string" defaultvalue="" description="" encode="true" format="None" formatvalue="" name="user_bidded_vehicle_hike" order="" paramOrder="4" parentOrder="-1" passnull="false" sms-name="" src="request" sourcevalue="" srcformatvalue="" target="request" targetdatatype="java.lang.String" testvalue="200" value="" isExtended="false">
            <accessType></accessType>
        </param>
        <template-param datatype="" defaultvalue="" description="" encode="false" format="" formatvalue="" name="criteria" order="" paramOrder="0" parentOrder="0" sms-name="" src="" sourcevalue="" srcformatvalue="" target="" targetdatatype="" value="" isExtended="false">
            <accessType></accessType>
        </template-param>
    </service-input>
    <service-output passthrough="false" isExtended="false"/>
</service>
